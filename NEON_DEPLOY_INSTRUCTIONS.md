# Инструкция по деплою UniFarm с принудительным использованием Neon DB

Для развёртывания UniFarm с принудительным использованием Neon DB (независимо от настроек в `.replit`), следуйте этим инструкциям:

## Предварительные требования

1. Настроенное подключение к Neon DB
2. Установленные переменные окружения NEON_PG_* или DATABASE_URL

## Процесс деплоя

### Автоматизированный деплой (рекомендуется)

1. Выполните:
   ```
   node deploy-with-neon.js
   ```

   Это автоматически:
   - Сохранит резервную копию `.replit`
   - Заменит его на версию с настройками Neon DB
   - Выполнит деплой с принудительным использованием Neon DB
   - Восстановит оригинальный `.replit` после завершения

### Ручной деплой

Если автоматизированный деплой не работает:

1. Скопируйте `.replit.neon` в `.replit`:
   ```
   cp .replit.neon .replit
   ```

2. Выполните деплой:
   ```
   replit deploy
   ```

3. Восстановите оригинальную конфигурацию:
   ```
   cp .replit.backup .replit
   ```

## Проверка деплоя

После деплоя проверьте:

1. Работоспособность основного сайта по URL вашего Replit
2. Подключение к Neon DB - проверьте, что используется именно Neon DB, а не Replit PostgreSQL
3. Работу партиционирования транзакций
4. Работу Telegram-бота и вебхуков

## Устранение проблем

- **Ошибка ES-модуля**: Удостоверьтесь, что используется `start-deployment.js` вместо `start-unified.js`
- **Проблемы с подключением к БД**: Проверьте, что переменные окружения для Neon DB правильно настроены
- **Ошибки партиционирования**: Используйте флаги `SKIP_PARTITION_CREATION=true` и `IGNORE_PARTITION_ERRORS=true`

## Важные заметки

- При деплое с настройками `.replit.neon` всегда используется Neon DB, независимо от переменных окружения
- Всегда проверяйте, что не произошло случайного переключения на Replit PostgreSQL
- Для локальной разработки можно использовать Replit PostgreSQL, но для продакшна всегда используйте Neon DB