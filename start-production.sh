#!/bin/bash

# –ó–∞–ø—É—Å–∫ UniFarm –≤ production —Ä–µ–∂–∏–º–µ
# –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –≤ —Ä–∞–±–æ—á–µ–º —Ä–µ–∂–∏–º–µ

echo "üöÄ –ó–∞–ø—É—Å–∫ UniFarm Telegram Mini App –≤ production —Ä–µ–∂–∏–º–µ..."

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export NODE_ENV=production

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
if [ ! -d "dist" ] || [ ! -f "dist/index.js" ]; then
  echo "‚ö†Ô∏è –°–±–æ—Ä–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞. –ó–∞–ø—É—Å–∫–∞–µ–º —Å–±–æ—Ä–∫—É –ø—Ä–æ–µ–∫—Ç–∞..."
  npm run build
  
  if [ $? -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –ø—Ä–æ–µ–∫—Ç–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞."
    exit 1
  fi
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram –±–æ—Ç–∞
if [ -z "$TELEGRAM_BOT_TOKEN" ]; then
  echo "‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è TELEGRAM_BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞!"
  echo "–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å Telegram Bot –±—É–¥–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞."
fi

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ—Ä—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞
PORT=5000

echo "üì° –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –ø–æ—Ä—Ç—É $PORT..."
# –ó–∞–ø—É—Å–∫ Node.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ production —Ä–µ–∂–∏–º–µ
PORT=$PORT node dist/index.js