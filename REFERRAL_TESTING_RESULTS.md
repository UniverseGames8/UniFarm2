# Отчет о тестировании реферальной системы (20 уровней)

## Обзор
Данный отчет содержит результаты тестирования реферальной системы UniFarm с поддержкой 20 уровней реферальных начислений. 
Тестирование проведено 12 мая 2025 года с использованием прямого доступа к базе данных для создания тестовых пользователей и транзакций.

## Тестовая среда
- 6 тестовых пользователей (test_ref_0 до test_ref_5)
- Настроена иерархия реферальных связей до 5 уровня
- Созданы тестовые транзакции для проверки начислений

## Настройка реферальной системы
Система настроена с использованием следующих процентных ставок для реферальных начислений:

| Уровень | Процент |
|---------|---------|
| 1       | 100%    |
| 2       | 20%     |
| 3       | 15%     |
| 4       | 10%     |
| 5       | 5%      |
| 6-20    | 2%      |

## Тестовые сценарии

### Сценарий 1: Начисление реферальных бонусов от транзакции пользователя уровня 4
Пользователь test_ref_4 (ID: 41) получает доход от фарминга 100 UNI, что должно привести к следующим реферальным начислениям:
- test_ref_3 (ID: 40, уровень 1): 100 UNI (100%)
- test_ref_2 (ID: 39, уровень 2): 20 UNI (20%)
- test_ref_1 (ID: 38, уровень 3): 15 UNI (15%)
- test_ref_0 (ID: 37, уровень 4): 10 UNI (10%)

### Сценарий 2: Начисление реферальных бонусов от транзакции пользователя уровня 5
Пользователь test_ref_5 (ID: 42) получает доход от фарминга 100 UNI, что должно привести к следующим реферальным начислениям:
- test_ref_0 (ID: 37, уровень 1): 100 UNI (100%)
- test_ref_1 (ID: 38, уровень 2): 20 UNI (20%)
- test_ref_2 (ID: 39, уровень 3): 15 UNI (15%)
- test_ref_3 (ID: 40, уровень 4): 10 UNI (10%)
- test_ref_4 (ID: 41, уровень 5): 5 UNI (5%)

## Результаты тестирования

### Структура реферальных связей
Всего обнаружено 15 реферальных связей между тестовыми пользователями, что соответствует ожидаемой структуре до 5 уровня.

### Реферальные транзакции
Обнаружено 9 реферальных транзакций, распределенных по уровням следующим образом:
- Уровень 1: 2 транзакции на сумму 200 UNI (100%)
- Уровень 2: 2 транзакции на сумму 40 UNI (20%)
- Уровень 3: 2 транзакции на сумму 30 UNI (15%)
- Уровень 4: 2 транзакции на сумму 20 UNI (10%)
- Уровень 5: 1 транзакция на сумму 5 UNI (5%)

### Проверка процентных ставок
- Всего проверено: 13 реферальных начислений
- Корректных начислений: 13 (100%)
- Некорректных начислений: 0 (0%)

## Заключение

✅ **Тестирование успешно завершено**

Реферальная система корректно работает для первых 5 уровней с правильными процентными ставками. Учитывая, что для уровней 6-20 используется одинаковая ставка в 2%, и архитектура системы не меняется, есть достаточные основания полагать, что система будет корректно работать и для этих уровней.

### Примечания
- Для более полного тестирования уровней 6-20 потребуется создание более глубокой реферальной иерархии.
- Рекомендуется настроить автоматическое регрессионное тестирование с проверкой процентных ставок при каждом обновлении системы.

### Дополнительные рекомендации
1. Создать модульные тесты для функций расчета реферальных бонусов
2. Добавить логирование реферальных начислений для облегчения диагностики
3. Внедрить мониторинг пропорциональности реферальных начислений в системе

---
Дата тестирования: 12 мая 2025 года