/**
 * –°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è .env.neon —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–ª—è Neon DB
 * 
 * –°–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª .env.neon —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Neon DB
 */

const fs = require('fs');

// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ .env.neon
if (fs.existsSync('.env.neon')) {
  console.log('\x1b[33m‚ö†Ô∏è –§–∞–π–ª .env.neon —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π? (y/n)\x1b[0m');
  // –í –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ –∑–¥–µ—Å—å –±—ã–ª –±—ã –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
  // –í —Å–∫—Ä–∏–ø—Ç–µ –ø—Ä–æ—Å—Ç–æ –≤—ã–≤–æ–¥–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º
  console.log('\x1b[33müëâ –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –±–µ–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–Ω–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º)\x1b[0m');
}

// –ü–æ–ª—É—á–∞–µ–º —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Neon DB –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏–ª–∏ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –≤–≤–æ–¥
const args = process.argv.slice(2);
let dbUrl = '';

if (args.length > 0 && args[0].includes('neon.tech')) {
  dbUrl = args[0];
  console.log(`\x1b[32m‚úÖ –ò—Å–ø–æ–ª—å–∑—É—é –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${dbUrl.replace(/:[^:]*@/, ':***@')}\x1b[0m`);
} else {
  console.log('\x1b[33m‚ö†Ô∏è –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Neon DB –Ω–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ —á–µ—Ä–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç—ã\x1b[0m');
  console.log('\x1b[33müëâ –î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Neon DB –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ —Å—Ç—Ä–æ–∫–∞ –≤–∏–¥–∞:\x1b[0m');
  console.log('\x1b[33m   postgresql://username:password@ep-example-id.region.aws.neon.tech/dbname?sslmode=require\x1b[0m');
  
  // –í –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ –∑–¥–µ—Å—å –±—ã–ª –±—ã –∑–∞–ø—Ä–æ—Å –Ω–∞ –≤–≤–æ–¥ —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
  // –í —Å–∫—Ä–∏–ø—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º —à–∞–±–ª–æ–Ω –¥–ª—è –ø—Ä–∏–º–µ—Ä–∞
  dbUrl = 'postgresql://neondb_owner:your_password@ep-example-id.region.aws.neon.tech/neondb?sslmode=require';
  console.log('\x1b[33müëâ –ò—Å–ø–æ–ª—å–∑—É—é —à–∞–±–ª–æ–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é –≤ —Ñ–∞–π–ª–µ .env.neon)\x1b[0m');
}

// –°–æ–∑–¥–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ .env.neon
const envContent = `# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Neon DB
# –°–æ–∑–¥–∞–Ω–æ —Å–∫—Ä–∏–ø—Ç–æ–º create-neon-env.cjs ${new Date().toISOString()}

# –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Neon DB
DATABASE_URL=${dbUrl}

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Neon DB
FORCE_NEON_DB=true
DISABLE_REPLIT_DB=true
OVERRIDE_DB_PROVIDER=neon
DATABASE_PROVIDER=neon
USE_LOCAL_DB_ONLY=false

# –î—Ä—É–≥–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
NODE_ENV=production
PORT=3000

# –¢–æ–∫–µ–Ω –¥–ª—è Telegram Bot (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
# TELEGRAM_BOT_TOKEN=your_bot_token_here
`;

// –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ñ–∞–π–ª
fs.writeFileSync('.env.neon', envContent);
console.log('\x1b[32m‚úÖ –§–∞–π–ª .env.neon —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!\x1b[0m');

// –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É
console.log('\n\x1b[34müìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:\x1b[0m');
console.log('\x1b[34m1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª .env.neon –∏ –∑–∞–º–µ–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ —Ä–µ–∞–ª—å–Ω—É—é\x1b[0m');
console.log('\x1b[34m2. –î–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ Neon DB –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: ./switch-db-config.sh neon\x1b[0m');
console.log('\x1b[34m3. –î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å Neon DB –≤—ã–ø–æ–ª–Ω–∏—Ç–µ: ./start-with-neon.sh\x1b[0m');